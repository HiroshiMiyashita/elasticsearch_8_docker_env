{
  "query": {
    "bool" : {
      "must" : [],
      "filter": [],
      "must_not" : [],
      "should" : [
        {
          "more_like_this" : {
            "fields" : ["doc_text"],
            "like" : "Once upon a time",
            "min_term_freq" : 1,
            "min_doc_freq": 1,
            "minimum_should_match": "30%"
          }
        }
      ],
      "minimum_should_match" : 1
    }
  },
  "size": 100,
  "rescore" : {
    "window_size" : 50,
    "query" : {
      "score_mode": "multiply",
      "rescore_query" : {
        "function_score" : {
          "functions": [
            {
              "script_score": {
                "script": {
                  "source": "return 1.0 + params.weidht * (doc[params.doc_vector].size() == 0 ? 0.0 : (cosineSimilarity(params.docVec, doc[params.field]) + 1));",
                  "params": {
                    "field": "doc_vector",
                    "docVec": [4, 3.4, -0.2],
                    "weight": 2.0
                  }
                }
              }
            },
            {
              "script_score": {
                "script": {
                  "source": "return 1.0 + params.weidht * (doc[params.doc_vector].size() == 0 ? 0.0 : (cosineSimilarity(params.docVec, doc[params.field]) + 1));",
                  "params": {
                    "field": "doc_vector",
                    "userVec": [4, 3.4, -0.2],
                    "weight": 2.0
                  }
                }
              }
            }
          ],
          "score_mode": "avg"
        }
      }
    }
  } 
}
